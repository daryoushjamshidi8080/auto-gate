{% extends "base.html" %}


{% block title %}
    تنظیمات
{% endblock %}

{% block content %}


  <div class="contaner d-flex m-5 ">
    <div class="m-lg-2">
      <div class="container bg-white p-4 rounded shadow">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">درب ها</h5>
          <div>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createAntennaModal">
              ایجاد آنتن جدید
            </button>

            <button class="btn btn-danger">حذف انتخاب شده‌ها</button>
          </div>
        </div>
      
        <table class="table table-bordered table-striped text-center align-middle">
          <thead class="table-dark">
            <tr>
              <th scope="col"><input type="checkbox"></th>
              <th scope="col">نام درب</th>
              <th scope="col">شماره رله</th>
              <th scope="col">زمان باز ماندن درب</th>
              <th scope="col">وضعیت</th>
              <th scope="col">عملیات</th>
            </tr>
          </thead>
          <tbody>
            {% for antenna in antennas %}
                <tr>
                  <td><input type="checkbox"></td>
                  <td>{{ antenna.name }}</td>
                  <td>{{ antenna.number }}</td>
                  <td>{{ antenna.open_time }}</td>
                  <td>
                    <input type="checkbox" name="is_active" {% if antenna.is_active %}checked{% endif %}>
                  </td>
                  <td class="d-flex">
                    <button class="btn btn-sm btn-success me-1">ویرایش</button>
                    <button class="btn btn-sm btn-danger">حذف</button>
                  </td>
                </tr>
            {% endfor %}
            <!-- سطرهای دیگر مثل بالا تکرار می‌شن -->
          </tbody>
        </table>
      </div>
    </div>
    <div class="m-lg-2">
      <div class="container bg-white p-4 rounded shadow">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">درب ها</h5>
          <div>
            <button class="btn btn-primary">ایجاد درب جدید</button>
            <button class="btn btn-danger">حذف انتخاب شده‌ها</button>
          </div>
        </div>
      
        <table class="table table-bordered table-striped text-center align-middle">
          <thead class="table-dark">
            <tr>
              <th scope="col"><input type="checkbox"></th>
              <th scope="col">نام درب</th>
              <th scope="col">شماره رله</th>
              <th scope="col">زمان باز ماندن درب</th>
              <th scope="col">عملیات</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="checkbox"></td>
              <td>ورود صنعتی یک</td>
              <td>210</td>
              <td>30</td>
              <td>
                <button class="btn btn-sm btn-success me-1">ویرایش</button>
                <button class="btn btn-sm btn-danger">حذف</button>
              </td>
            </tr>
            <tr>
              <td><input type="checkbox"></td>
              <td>خروج صنعتی یک</td>
              <td>195</td>
              <td>30</td>
              <td>
                <button class="btn btn-sm btn-success me-1">ویرایش</button>
                <button class="btn btn-sm btn-danger">حذف</button>
              </td>
            </tr>
            <!-- سطرهای دیگر مثل بالا تکرار می‌شن -->
          </tbody>
        </table>
      </div>
    </div>
  </div>



<div class="modal fade" id="createAntennaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="antennaCreateForm" method="post">
        {% csrf_token %}

        <div class="modal-header">
          <h5 class="modal-title">ایجاد آنتن</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="antenna-modal-body">
          <!-- اینجا با Ajax فرم لود میشه -->
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">ثبت</button>
        </div>
      </form>
    </div>
  </div>
</div>



  
{% endblock %}  

{% block js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('createAntennaModal');
    const modalBody = document.getElementById('antenna-modal-body');
    const form = document.getElementById('antennaCreateForm');

    modal.addEventListener('show.bs.modal', function () {
      fetch("{% url 'setting:create_antenna' %}")
        .then(res => res.json())
        .then(data => {
          modalBody.innerHTML = data.form_html;
        });
    });

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      
      const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
      console.log("csrf input:", csrfInput);
      
      const formData = new FormData(form);
      fetch("{% url 'setting:create_antenna' %}", {
        method: 'POST',
        body: formData
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            const bsModal = bootstrap.Modal.getInstance(modal);
            bsModal.hide();
            form.reset();
            alert("✅ آنتن با موفقیت ثبت شد!"); //create antenna
          } else {
            modalBody.innerHTML = data.form_html;
          }
        });
    });

    
  });
</script>


{% endblock %}